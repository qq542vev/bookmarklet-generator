<!DOCTYPE html>
<html
	xmlns="http://www.w3.org/1999/xhtml"
	lang="en"
	xml:lang="en"
	about=""
	typeof="schema:SoftwareApplication"
>
	<head>
		<meta charset="UTF-8" />
		<meta name="application-name" content="Bookmarklet Generator" />
		<meta name="author" property="dc11:creator" content="風は風に" />
		<meta name="copyright" property="dc11:rights" content="Copyright © 2019 風は風に. Some rights reserved." />
		<meta name="dcterms.created" property="dcterms:created" datatype="dcterms:W3CDTF" content="2019-04-12" />
		<meta name="dcterms.modified" property="dcterms:modified" datatype="dcterms:W3CDTF" content="2019-04-12" />
		<meta name="keywords" property="schema:keywords" content="JavaScript,Bookmarklet,Generator" />
		<meta name="msapplication-starturl" content="?" />
		<meta name="robots" content="index,follow" />
		<meta name="version" property="schema:version" content="0.1.0" />

		<title property="dcterms:title">Bookmarklet Generator</title>

		<link rel="author dcterms:creator" href="https://purl.org/meta/me/" />
		<link rel="start" title="Start page" href="?" />
		<link rel="copyright license" title="Creative Commons License" href="https://creativecommons.org/licenses/by/4.0/" />
		<link rel="dcterms:conformsTo" title="Valid HTML+RDFa 1.1" href="http://www.w3.org/TR/html-rdfa/" />
		<link rel="profile grddl:profileTransformation" href="http://ns.inria.fr/grddl/rdfa/" />
		<link rel="sidebar" href="javascript:" title="Bookmarkret" />

		<!-- Load Normalize.css -->
		<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/1.1.3/normalize.min.css" />

		<!-- Load jQuery -->
		<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>

		<!-- Load CodeMirror -->
		<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.45.0/codemirror.min.css" />
		<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.45.0/codemirror.min.js"></script>
		<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.45.0/mode/javascript/javascript.min.js"></script>

		<!-- Load highlight.js -->
		<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/styles/default.min.css" />
		<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/highlight.min.js"></script>

		<!-- Load UglifyJS3 -->
		<script type="text/javascript" src="lib/minify.js"></script>
		<script type="text/javascript" src="lib/utils.js"></script>
		<script type="text/javascript" src="lib/ast.js"></script>
		<script type="text/javascript" src="lib/parse.js"></script>
		<script type="text/javascript" src="lib/transform.js"></script>
		<script type="text/javascript" src="lib/scope.js"></script>
		<script type="text/javascript" src="lib/output.js"></script>
		<script type="text/javascript" src="lib/compress.js"></script>
		<script type="text/javascript" src="lib/propmangle.js"></script>

		<style type="text/css">/*<![CDATA[*/
			body {
				width: 95%;
				margin: 0 auto;
				margin: 15px auto;
				line-height: 1.6;
			}

			textarea:focus, input:focus {
				background: #FFFFE8;
			}

			h1, caption, thead, time {
				display: none;
			}

			#output pre {
				border: 1px solid #666666;
				padding: 0.5em;
				background: #F0F0F0;
				white-space: pre-wrap;
				word-wrap: break-word;
			}

			pre, code, var, samp, kbd {
				font-family: "Source Code Pro", "Ubuntu Mono", "Consolas", "Inconsolata", "Menlo", "Courier New", "Courier", "Bitstream Vera Sans Mono", "Monaco", monospace, sans-serif;
			}

			.uri {
				display: block;
				padding: 0.5em;
			}

			#mainForm {
				position: relative;
			}

			#js_code, .CodeMirror {
				ime-mode: inactive;
				font-family: "Source Code Pro", "Ubuntu Mono", "Consolas", "Inconsolata", "Menlo", "Courier New", "Courier", "Bitstream Vera Sans Mono", "Monaco", monospace, sans-serif;
			}

			#js_code {
				width: 100%;
				white-space: pre;
			}

			#name {
				width: 12em;
			}

			#submit {
				float: left;
				padding: 0;
				margin-top: 0;
			}

			#status {
				float: left;
				padding: 0;
				margin-top: 0;
				margin-left: 1em;
			}

			.checkbox_item {
				display: inline-block;
				margin: 0.2em;
				padding: 0 0.2em;
				background: #F0F0F0;
				cursor: pointer;
			}

			.checkbox_item input {
				cursor: pointer;
			}

			#option {
				clear: both;
			}

			#menu {
				position: absolute;
				top: 0;
				right: 25px;
				margin: 0;
				padding: 0;
				z-index: 1000;
				list-style: none;
			}

			#beautify, #purl, #run, #reset, #autoChange {
				background: #FFFFFF;
				border: 1px solid #C0C0C0;
				margin: 0.2em 0;
				padding: 0.2em 0.3em;
				font-size: 120%;
				font-weight: bold;
			}

			#footerNavigation {
				margin-right: 0;
				margin-left: 0;
				padding-right: 0;
				padding-left: 0;
			}

			#footerNavigation li {
				display: inline;
				margin: 0 0.5em;
			}

			.delimiter {
				color: #000000;
			}

			.scheme {
				color: #FF0000;
			}

			.path {
			}

			.sub-delimiter {
				color: #880000;
			}

			.percent-encoded {
				color: #397300;
			}

			@media print {
				#submit, #status, #menu, #option {
					display: none;
				}
			}
		/*]]>*/</style>

		<script type="text/javascript">//<![CDATA[
			var jsEditor;

			var applicationName = document.title;

			/**
			 * Persistent URL of service.
			 *
			 * @type {string}
			 * @see https://purl.org/
			 */
			var purl = "https://purl.org/meta/utility/bookmarklet_generator/";

			/**
			 * URI path sub delimiters.
			 *
			 * @type {object}
			 * @see https://tools.ietf.org/html/rfc3986#section-3.3
			 */
			var uriPathUnencodeCharacters = {
				"exclamation_mark": "!",
				"dollar_sign": "\\$",
				"ampersand": "&",
				"apostrophe": "'",
				"left_parenthesis": "\\(",
				"right_parenthesis": "\\)",
				"asterisk": "\\*",
				"plus_sign": "\\+",
				"comma": ",",
				"semicolon": ";",
				"equals_sign": "=",
				"colon": ":",
				"commercial_at": "@",
				"iri_characters":
					"[\u00A0-\uD7FF]|[\uF900-\uFDCF]|[\uFDF0-\uFFEF]|" +      // \u{00A0}-\u{D7FF} | \u{F900}-\u{FDCF} | \u{FDF0}-\u{FFEF}
					"[\uD800-\uD83E][\uDC00-\uDFFF]|\uD83F[\uDC00-\uDFFD]|" + // \u{10000}-\u{1FFFD}
					"[\uD840-\uD87E][\uDC00-\uDFFF]|\uD87F[\uDC00-\uDFFD]|" + // \u{20000}-\u{2FFFD}
					"[\uD880-\uD8BE][\uDC00-\uDFFF]|\uD8BF[\uDC00-\uDFFD]|" + // \u{30000}-\u{3FFFD}
					"[\uD8C0-\uD8FE][\uDC00-\uDFFF]|\uD8FF[\uDC00-\uDFFD]|" + // \u{40000}-\u{4FFFD}
					"[\uD900-\uD93E][\uDC00-\uDFFF]|\uD93F[\uDC00-\uDFFD]|" + // \u{50000}-\u{5FFFD}
					"[\uD940-\uD97E][\uDC00-\uDFFF]|\uD97F[\uDC00-\uDFFD]|" + // \u{60000}-\u{6FFFD}
					"[\uD980-\uD9BE][\uDC00-\uDFFF]|\uD9BF[\uDC00-\uDFFD]|" + // \u{70000}-\u{7FFFD}
					"[\uD9C0-\uD9FE][\uDC00-\uDFFF]|\uD9FF[\uDC00-\uDFFD]|" + // \u{80000}-\u{8FFFD}
					"[\uDA00-\uDA3E][\uDC00-\uDFFF]|\uDA3F[\uDC00-\uDFFD]|" + // \u{90000}-\u{9FFFD}
					"[\uDA40-\uDA7E][\uDC00-\uDFFF]|\uDA7F[\uDC00-\uDFFD]|" + // \u{A0000}-\u{AFFFD}
					"[\uDA80-\uDABE][\uDC00-\uDFFF]|\uDABF[\uDC00-\uDFFD]|" + // \u{B0000}-\u{BFFFD}
					"[\uDAC0-\uDAFE][\uDC00-\uDFFF]|\uDAFF[\uDC00-\uDFFD]|" + // \u{C0000}-\u{CFFFD}
					"[\uDB00-\uDB3E][\uDC00-\uDFFF]|\uDB3F[\uDC00-\uDFFD]|" + // \u{D0000}-\u{DFFFD}
					"[\uDB40-\uDB7E][\uDC00-\uDFFF]|\uDB7F[\uDC00-\uDFFD]"    // \u{E0000}-\u{EFFFD}
			};

			/**
			 * HTTP Ajax request options for jQuery.
			 *
			 * @type {object}
			 * @see https://api.jquery.com/jquery.ajax/
			 */
			var httpAjaxRequestOption = {
				"crossDomain": true,
				"timeout": 30000,
				//"beforeSend": function() {
				//	$("#status output").html("<em>Loading... <\/em>");
				//},
				"xhr": generateCORSRequest,
				//"xhrFields": {
				//	"onprogress": function(event) {
				//		console.log(ajaxRequestTime);
				//		$("#status output").html("<em>Loading... " + Math.floor(event.loaded / event.total * 100) + "%<\/em>");
				//	}
				//}
			};

			/**
			 * Closure Compiler Service request options.
			 *
			 * @type {object}
			 * @see https://developers.google.com/closure/compiler/docs/api-ref
			 */
			var closureCompilerRequestOption = $.extend(httpAjaxRequestOption, {
				"url": "https://closure-compiler.appspot.com/compile",
				"type": "POST",
				"headers": {
					"Accept": "application/json, application/x-json;q=0.9, */*;q=0.8"
				},
				"data": {
					"js_code": "",
					"compilation_level": "SIMPLE_OPTIMIZATIONS",
					"output_info": "compiled_code",
					"output_format": "text"
				},
				"dataType": "text"
			});

			/**
			 * Add bookmark.
			 *
			 * @param {string} url - Bookmark URL
			 * @param {string} title - Bookmark title
			 * @return {boolean}
			 */
			function addBookmark(url, title) {
				if(window.external && ("AddFavorite" in window.external)) {
					return window.external.AddFavorite(url, title);
				} else if(window.sidebar && window.sidebar.addPanel) {
					return window.sidebar.addPanel(title, url, "");
				}

				return false;
			}

			/**
			 * Get character count.
			 *
			 * @param {string} str - String
			 * @return {number}
			 */
			function characterCount(str) {
				return $.grep(str.split(""), function(value) {
					var codePoint = value.charCodeAt();

					return codePoint <= 0xDBFF || 0xE000 <= codePoint
				}).length;
			}

			/**
			 * Decode application/x-www-form-urlencoded.
			 *
			 * @param {string} str - String
			 * @return {string}
			 * @see https://url.spec.whatwg.org/#percent-decode
			 */
			function decodeFormData(str) {
				return decodeURIComponent(str.replace(/\+/g, " "));
			}

			/**
			 * Generate bookmarklet URL.
			 *
			 * @param {string} jsCode - JavaScript code
			 * @param {string} [unencodeChar] - Unencoded characters of regular expression pattern
			 * @return {string}
			 */
			function generateBookmarklet(jsCode, unencodeChar) {
				return uriPercentEncode($.trim(jsCode), unencodeChar);
			}

			/**
			 * Generate CORS Request Object.
			 *
			 * @return {XMLHttpRequest|XDomainRequest|null}
			 */
			function generateCORSRequest() {
				var xhr = new XMLHttpRequest();

				if("withCredentials" in xhr) {
					return xhr;
				} else if(typeof XDomainRequest !== "undefined") {
					return new XDomainRequest();
				}

				return null;
			}

			/**
			 * Get URI query parameters.
			 *
			 * @param {string} [query=location.search] URI query
			 * @return {object}
			 */
			function getQuery(query) {
				var param = query || location.search;

				return parseFormData(param.indexOf("?") ? "" : param.substring(1));
			}

			/**
			 * Number Format.
			 *
			 * @param {number} number - Number
			 * @return {string}
			 */
			function numberFormat(number) {
				return number.toString().replace(/(\d)(?=(\d\d\d)+(?!\d))/g, "$1,");
			}

			/**
			 * Parse application/x-www-form-urlencoded.
			 *
			 * @param {string} data - URL encoded data
			 * @return {object}
			 * @see https://url.spec.whatwg.org/#urlencoded-parsing
			 */
			function parseFormData(data) {
				var result = {};

				data.split("&").forEach(function(value) {
					var pair = value.split("=");

					result[decodeFormData(pair[0])] = pair[1] ? decodeFormData(pair[1]) : "";
				});

				return result;
			}

			function statusUpdate(content, date) {
				date = date || new Date();

				if(new Date($("#status time").text()).getTime() < date.getTime()) {
					$("#status output").empty().append(
						content,
						" ",
						$("<time><\/time>").text(date.toISOString())
					);

					return true;
				}

					return false;
			}

			/**
			 * Output Bookmarklet URL.
			 *
			 * @param {string} compressedJsCode - Compressed JavaScript code
			 * @param {string} originalJsCode - Original JavaScript code
			 */
			function outputBookmarklet(compressedJsCode, originalJsCode, date) {
				originalJsCode = originalJsCode || compressedJsCode;
				date = date || new Date();
				var path = generateBookmarklet(compressedJsCode, $("input:checkbox:checked[name^=unencode_][value=1]").map(function() {
					return uriPathUnencodeCharacters[this.name.substring("unencode_".length)];
				}).get().join("|"));
				var uri = "javascript:" + path;
				var name = $("#name").val() || "Bookmarkret";
				var byteCount = numberFormat(utf8ByteCount(uri));
				var formData = $("#mainForm").serializeArray();


				if(statusUpdate([
					$("<link />", {
						"rel": "foaf:page",
						"type": "text/html",
						"href": "?" + $.param($.map(formData, function(field) {
							if(field.name === "js_code") {
								return $(field).prop("value", originalJsCode)[0];
							}

							return field;
						}))
					}),
					$("#optimize").val() === "no" ? "" : $("<link />", {
						"rel": "foaf:page",
						"type": "text/html",
						"href": "?" + $.param($.map(formData, function(field) {
							if(field.name === "js_code") {
								return $(field).prop("value", compressedJsCode)[0];
							} else if(field.name === "optimize") {
								return $(field).prop("value", "no")[0];
							}

							return field;
						}))
					}),
					$("<strong><\/strong>").append(
						$("<a><\/a>", {
							"rel": "sidebar",
							"rev": "owl:sameAs",
							"href": uri,
							"title": name,
							"property": "dcterms:title",
							"text": name,
							"click": function() {
								addBookmark(this.href, $(this).text());
							}
						})
					),
					" - ",
					$("<span><\/span>", {
						"property": "schema:fileSize",
						"title": byteCount + " Bytes / " + characterCount(uri) + " Characters",
						"text": byteCount + " Bytes"
					})
				], date)) {
					$("#message .message").remove();

					document.title = ($("#name").val() ? name + " - " : "") + applicationName;

					$("link[rel=sidebar]").attr({
						"href": uri,
						"title": name
					});

					var delimiter = RegExp("(" + $.map(uriPathUnencodeCharacters, String).join("|") + "|%[\\dA-Fa-f]{2})");
					var subDelimiter = RegExp($.map(uriPathUnencodeCharacters, function(value, key) {
						return key === "iri_characters" ? null : value;
					}).join("|"));
					var iriCharacter = RegExp(uriPathUnencodeCharacters.iri_characters)
					var percentEncoded = /%[\dA-Fa-f]{2}/;

					$("#bookmarkletURI").attr("title", compressedJsCode).find(".path").empty().append(
						$.map(path.split(delimiter), function(value) {
							if(subDelimiter.test(value)) {
								return $("<span class='sub-delimiter'><\/span>").text(value);
							} else if(iriCharacter.test(value)) {
								return $("<span class='iri-character'><\/span>").text(value);
							} else if(percentEncoded.test(value)) {
								return $("<span class='percent-encoded'><\/span>").text(value);
							}

							return value;
						})
					);

					$("#normalHtmlCode code").text(
						$("<div><\/div>").append($("<a><\/a>", {
							"href": uri,
							"title": name,
							"text": name
						})).html()
					);

					$("#extendedHtmlCode code").text(
						$("<div><\/div>").append($("<a><\/a>", {
							"rel": "sidebar",
							"href": uri,
							"title": name,
							"text": name,
							"onclick": "(function(t,w){var e=w.external,s=w.sidebar;if(e&&('AddFavorite' in e)){e.AddFavorite(t.href,t.title);}else if(s&&s.addPanel){s.addPanel(t.title,t.href,'');}})(this,window);"
						})).html()
					);

					$("#markdownCode code").text("[" + name.replace(/\]/g, "\\]") + "](" + uri.replace(/\)/g, "\\)") + " \""+ name.replace(/"/g, "\\\"") +"\")");

					$("#normalHtmlCode code, #extendedHtmlCode code, #markdownCode code").each(function() {
						hljs.highlightBlock(this);
					});
				}
			}

			/**
			 * Output Messages (Error, Warning, Etc...).
			 *
			 * @param {string} status - Status message
			 */

			function outputMessage(status) {
				var args = $.makeArray(arguments).slice(1);
				var message = $("#message pre.message > samp");

				$("#status output").empty().append(
					$("<em><\/em>").append(status)
				);

				$.each(args, function(key, value) {
					$(message[key] || $("<samp><\/samp>").appendTo($("<pre class='message'><\/pre>").appendTo("#message"))).empty().append(value);
				});

				message.slice(args.length).remove();
			}

			/**
			 * Copy to clipboard.
			 *
			 * @param {string} text - String
			 * @return {boolean}
			 */
			function textCopy(text) {
				var result = false;

				if(window.clipboardData) {
					return window.clipboardData.setData("Text", text);
				} else if(document.execCommand) {
					var top = $(window).scrollTop();
					var left = $(window).scrollLeft();

					try {
						var textarea = $("<textarea style='margin:0; border:0; padding:0; width:0; height:0;'><\/textarea>").val(text).appendTo("body");
						textarea[0].focus();
						textarea[0].select();
						result = document.execCommand("copy");
					} catch(error) {}

					textarea.remove();

					$(window).scrollTop(top);
					$(window).scrollLeft(left);
				}

				return result;
			}

			/**
			 * URI percent encode.
			 *
			 * @param {string} str - String
			 * @param {string} [unencodeChar] - Unencoded characters of regular expression pattern
			 * @return {string}
			 * @see https://tools.ietf.org/html/rfc3986#section-2.1
			 */
			function uriPercentEncode(str, unencodeChar) {
				var reg = RegExp(unencodeChar ? "(" + (unencodeChar) + ")" : "^$");

				return $.map(str.split(reg), function(value) {
					return reg.test(value) ? value : encodeURIComponent(value).replace(/[!'()*]/g, function(match) {
						return "%" + match.charCodeAt(0).toString(16);
					});
				}).join("");
			}

			/**
			 * Get UTF-8 byte count.
			 *
			 * @param {string} str - String
			 * @return {number}
			 * @see https://www.softel.co.jp/blogs/tech/archives/3318
			 */
			function utf8ByteCount(str) {
				return encodeURI(str).replace(/%[\dA-Fa-f]{2}/g, "*").length
			}

			/**
			 * Callback function when Ajax done.
			 */
			function ajaxDone(data, textStatus, jqXHR, ) {
				console.log(this);
				console.log(jqXHR);

				outputBookmarklet(data, this.data.js_code, ajaxRequestTime);
			}

			/**
			 * Callback function when Ajax fail.
			 */
			function ajaxFail(jqXHR, textStatus, errorThrown, ajaxRequestTime) {
				if(jqXHR.status) {
					var code = $("<code class='http'><\/code>").text(
						[
							["HTTP", jqXHR.status, jqXHR.statusText].join(" "),
							jqXHR.getAllResponseHeaders(),
							jqXHR.responseText
						].join("\r\n")
					);

					outputMessage("HTTP Response Error", code);

					hljs.highlightBlock(code[0]);
				} else {
					outputMessage(textStatus);
				}

				if(errorThrown.message) {
					$("<pre title='Error Message'><\/pre>").append(
						$("<samp><\/samp>").text(errorThrown.message)
					).appendTo("#output");
				}
			}

			/**
			 * Page rewrite.
			 */
			function pageRewrite() {
				var jsCode = jsEditor.doc.getValue();
				var optimize = $("#optimize").val();

				if(optimize === "no") {
					outputBookmarklet(jsCode);
				} else if(!optimize.indexOf("cc_")) {
					var ajaxRequestTime = new Date();

					$.ajax($.extend(true, closureCompilerRequestOption, {
						"data": {
							"js_code": jsCode,
							"compilation_level": optimize.substring(3)
						},
						"beforeSend": function() {
							statusUpdate($("<em>Loading... <\/em>"), ajaxRequestTime);
						},
						"xhrFields": {
							"onprogress": function(event) {
								statusUpdate($("<em>Loading... " + Math.floor(event.loaded / event.total * 100) + "%<\/em>"), ajaxRequestTime);
							}
						}
					})).done(function(data, textStatus, jqXHR) {
						ajaxDone(data, textStatus, jqXHR, ajaxRequestTime);
					}).fail(function(jqXHR, textStatus, errorThrown) {
						ajaxFail(jqXHR, textStatus, errorThrown, ajaxRequestTime);
					});
				} else {
					var minifiedJsCode = minify(jsCode);

					if(typeof minifiedJsCode.code === "string") {
						outputBookmarklet(minifiedJsCode.code, jsCode)
					} else if(minifiedJsCode.error) {
						outputMessage(
							minifiedJsCode.error.name,
							$.map({"line": "Line", "col": "Col", "pos": "Position"}, function(value, key) {
								return value + ": " + minifiedJsCode.error[key]
							}).join(", ") + "\n" + minifiedJsCode.error.message
						);
					}
				}
			}

			$(function() {
				var query = getQuery();

				$(window).on("hashchange", function() {
					var element = document.getElementById(location.hash.substring(1));

					if(element) {
						$(document.activeElement).blur();
						$(element).focus();
					}
				}).trigger("hashchange");

				$("#js_code").val(query.js_code).prop({
					"selectionStart": 0,
					"selectionEnd": 0
				});

				$("#name").val(query.name);

				if(query.auto) {
					$("#auto").val(query.auto);
				}

				$("#optimize option[value]").each(function(index, element) {
					if(this.value === query.optimize) {
						$("#optimize").val(query.optimize);
					}
				});

				$.each(query, function(key, value) {
					if(!key.indexOf("unencode_") && value === "1") {
						$("#" + key).prop("checked", true);
					}
				});

				jsEditor = CodeMirror.fromTextArea($("#js_code")[0], {
					"mode": "javascript",
					"lineNumbers": true,
					"indentUnit": 4,
					"showCursorWhenSelecting": true,
					"cursorScrollMargin": 2
				});
				jsEditor.on("change", function() {
					if($("#auto").val() === "1") {
						pageRewrite();
					}
				});
				jsEditor.on("blur", function(CodeMirror) {
					CodeMirror.save();

					if($("#auto").val() !== "1") {
						pageRewrite();
					}
				});

				$("#name, #optimize, #mainForm :checkbox").change(pageRewrite);

				$("#auto").change(function() {
					$("#autoChange").attr("class", $(this).val() === "1" ? "on" : "off");
				});

				$("#reset").click(function() {
					jsEditor.doc.setValue("");
					jsEditor.save();

					return false;
				});

				$("<li><button id='autoChange' type='button' title='Auto'>⇅<\/button><\/li>").click(function() {
					$("#auto").val(function(index, value) {					
						return (Number(value) + 1) % 2
					});

					$("#auto").change();
				}).prependTo("#menu");
				$("#auto").change();

				$("<li><button id='run' type='button' title='Run JavaScript Code'>▶<\/button><\/li>").click(function() {
					$.globalEval(jsEditor.doc.getValue());
				}).prependTo("#menu");

				$("<li><button id='purl' type='button' title='Persistent URL'>✩<\/button><\/li>").click(function() {
					var result = prompt(
						"Persistent URL of current input status.\n" +
						"Go to Persistent URL?",
						purl + "?" + $("#mainForm").serialize()
					);

					result && (location.href = result);
				}).prependTo("#menu");

				$("<li><button id='beautify' type='button' title='Beautify JavaScript Code'>⇉<\/button><\/li>").click(function() {
					var minifiedJsCode = minify(jsEditor.doc.getValue(), {
						"compress": false,
						"mangle": false,
						"output": {
							"beautify": true,
							"comments": true
						}
					});

					minifiedJsCode.code && jsEditor.doc.setValue(minifiedJsCode.code);
				}).prependTo("#menu");

				$("#unencode_characters td").append(
					" ",
					$("<button type='button' title='All check or all uncheck'>toggle☑<\/button>").click(function() {
						var checkbox = $("#unencode_characters input:checkbox");

						checkbox.prop("checked", $("#unencode_characters input:checked").length <= (checkbox.length / 2));

						pageRewrite();
					})
				);

				$("#output pre").dblclick(function() {
					textCopy($(this).text());
					window.getSelection().selectAllChildren(this);
				});

				$("#updateCheck a[href]").click(function() {
					$.ajax({
						"url": this.href,
						"dataType": "jsonp",
						"jsonp": false,
						"jsonpCallback": "callback"
					}).done(function(data) {
						var version = $("meta[name=version]").attr("content");
						var update = $("meta[name=dcterms\\.created]").attr("content");

						data.version === version ? alert("There is no new version.") : confirm(
							"There is a new version.\n" +
							"Do you want to download a new version?\n\n" +
							"Current version: " + version + " (Update: " + update + ")\n" +
							"New version: " + data.version + " (Update: " + data.update + ")\n"
						) && (location.href = data.downloadURL);
					});

					return false;
				});

				pageRewrite();
			});
		//]]></script>
	</head>
	<body role="application">
		<main>
			<section id="input" rel="dcterms:hasPart" resource="#input">
				<h1 property="dcterms:title">Input JavaScript Code</h1>

				<form id="mainForm" action="?" method="GET" accept-charset="UTF-8">
					<p><textarea id="js_code" name="js_code" cols="72" rows="24" autofocus="autofocus" placeholder="Enter JavaScript code for Bookmarklet." title="JavaScript code for bookmarklet.">Please enable JavaScript to use the feature.</textarea></p>

					<p id="submit">
						<input id="name" type="text" name="name" placeholder="Bookmarklet Name" title="Bookmarklet Name" />
						<select id="optimize" name="optimize" title="Optimize Level">
							<option value="no">No optimization</option>
							<option value="UglifyJS2" selected="selected">UglifyJS2</option>
							<optgroup label="Closure Compiler">
								<option value="cc_WHITESPACE_ONLY">Whitespace only</option>
								<option value="cc_SIMPLE_OPTIMIZATIONS">Simple optimization</option>
								<option value="cc_ADVANCED_OPTIMIZATIONS">Advanced optimization</option>
							</optgroup>
						</select>
						<input type="submit" />
						<input id="auto" type="hidden" name="auto" value="0" />
					</p>

					<p id="status" role="status" about="[_:bookmarklet]" typeof="schema:SoftwareApplication"><output><strong><a rel="sidebar" href="javascript:" title="Bookmarkret" property="dcterms:title">Bookmarkret</a></strong> - <span property="schema:fileSize" title="11 Bytes / 11 Characters">11 Bytes</span> <time>2019-04-12T00:00:00Z</time></output></p>

					<ul id="menu">
						<li><input id="reset" type="reset" value="×" title="Form reset" /></li>
					</ul>

					<table id="option">
						<caption>More Options</caption>
						<thead>
							<tr>
								<th scope="col">Option Name</th>
								<th scope="col">Option Value</th>
							</tr>
						</thead>
						<tbody>
							<tr id="unencode_characters">
								<th scope="row">Unencode characters</th>
								<td>
									<label class="checkbox_item" for="unencode_exclamation_mark" title="Exclamation mark">
										<input id="unencode_exclamation_mark" type="checkbox" name="unencode_exclamation_mark" value="1" />
										<code>!</code>
									</label>
									<label class="checkbox_item" for="unencode_dollar_sign" title="Dollar sign">
										<input id="unencode_dollar_sign" type="checkbox" name="unencode_dollar_sign" value="1" />
										<code>$</code>
									</label>
									<label class="checkbox_item" for="unencode_ampersand" title="Ampersand">
										<input id="unencode_ampersand" type="checkbox" name="unencode_ampersand" value="1" />
										<code>&amp;</code>
									</label>
									<label class="checkbox_item" for="unencode_apostrophe" title="Apostrophe">
										<input id="unencode_apostrophe" type="checkbox" name="unencode_apostrophe" value="1" />
										<code>'</code>
									</label>
									<label class="checkbox_item" for="unencode_left_parenthesis" title="Left parenthesis">
										<input id="unencode_left_parenthesis" type="checkbox" name="unencode_left_parenthesis" value="1" />
										<code>(</code>
									</label>
									<label class="checkbox_item" for="unencode_right_parenthesis" title="Right parenthesis">
										<input id="unencode_right_parenthesis" type="checkbox" name="unencode_right_parenthesis" value="1" />
										<code>)</code>
									</label>
									<label class="checkbox_item" for="unencode_asterisk" title="Asterisk">
										<input id="unencode_asterisk" type="checkbox" name="unencode_asterisk" value="1" />
										<code>*</code>
									</label>
									<label class="checkbox_item" for="unencode_plus_sign" title="Plus sign">
										<input id="unencode_plus_sign" type="checkbox" name="unencode_plus_sign" value="1" />
										<code>+</code>
									</label>
									<label class="checkbox_item" for="unencode_comma" title="Comma">
										<input id="unencode_comma" type="checkbox" name="unencode_comma" value="1" />
										<code>,</code>
									</label>
									<label class="checkbox_item" for="unencode_semicolon" title="Semicolon">
										<input id="unencode_semicolon" type="checkbox" name="unencode_semicolon" value="1" />
										<code>;</code>
									</label>
									<label class="checkbox_item" for="unencode_equals_sign" title="Equals sign">
										<input id="unencode_equals_sign" type="checkbox" name="unencode_equals_sign" value="1" />
										<code>=</code>
									</label>
									<label class="checkbox_item" for="unencode_colon" title="Colon">
										<input id="unencode_colon" type="checkbox" name="unencode_colon" value="1" />
										<code>:</code>
									</label>
									<label class="checkbox_item" for="unencode_commercial_at" title="Commercial at">
										<input id="unencode_commercial_at" type="checkbox" name="unencode_commercial_at" value="1" />
										<code>@</code>
									</label>
									<label class="checkbox_item" for="unencode_iri_characters" title="IRI Characters">
										<input id="unencode_iri_characters" type="checkbox" name="unencode_iri_characters" value="1" />
										<abbr title="Internationalized Resource Identifiers">IRI</abbr> Characters
									</label>
								</td>
							</tr>
						</tbody>
					</table>
				</form>
			</section>
			<section id="message" rel="dcterms:hasPart" resource="#message">
				<h1 property="dcterms:title">Messages</h1>
			</section>
			<section id="output" rel="dcterms:hasPart" resource="#output">
				<h1 property="dcterms:title">Output Bookmarklet</h1>

				<pre id="bookmarkletURI"><output form="mainForm"><code class="iri"><span class="scheme">javascript<span class="delimiter">:</span></span><span class="path"></span></code></output></pre>

				<table id="moreOutputCode">
					<caption>More Output Codes</caption>
					<tbody>
						<tr>
							<th scope="row">HTML Code (normal)</th>
							<td title="HTML Code (normal)">
								<pre id="normalHtmlCode"><output form="mainForm"><code class="html">&lt;a title="Bookmarklet" href="javascript:"&gt;Bookmarklet&lt;/a&gt;</code></output></pre>
							</td>
						</tr>
						<tr>
							<th scope="row">HTML Code (extended)</th>
							<td title="HTML Code (extended)">
								<pre id="extendedHtmlCode"><output form="mainForm"><code class="html">&lt;a title="Bookmarklet" rel="sidebar" href="javascript:" onclick="(function(t,w){var e=w.external,s=w.sidebar;if(e&amp;&amp;('AddFavorite' in e)){e.AddFavorite(t.href,t.title);}else if(s&amp;&amp;s.addPanel){s.addPanel(t.title,t.href,'');}})(this,window);"&gt;Bookmarklet&lt;/a&gt;</code></output></pre>
							</td>
						</tr>
						<tr>
							<th scope="row">Markdown Code</th>
							<td title="Markdown Code">
								<pre id="markdownCode"><output form="mainForm"><code class="markdown">[Bookmarklet](javascript: "Bookmarklet")</code></output></pre>
							</td>
						</tr>
					</tbody>
				</table>
			</section>
		</main>
		<footer>
			<nav>
				<ul id="footerNavigation">
					<li><a title="Bookmarklet Template" href="?js_code=%28function%28%29+%7B%0D%0A++++%0D%0A%0D%0A%0D%0A%7D%29%28%29%3B&amp;optimize=cc_SIMPLE_OPTIMIZATIONS">Template</a></li>
					<li id="bookmarkletThisTool"><a href="?js_code=%28function%28document%2C+location%29+%7B%0D%0A++++function+formUrlEncode%28str%29+%7B%0D%0A++++++++return+encodeURIComponent%28str%29.replace%28%2F%5B%7E%21%27%28%29%5D%2Fg%2C+function%28c%29+%7B%0D%0A++++++++++++return+%22%25%22+%2B+c.charCodeAt%280%29.toString%2816%29%3B%0D%0A++++++++%7D%29.replace%28%2F%2520%2Fg%2C+%22%2B%22%29%3B%0D%0A++++%7D%0D%0A%0D%0A++++var+url+%3D+%22https%3A%2F%2Fpurl.org%2Fmeta%2Futility%2Fbookmarklet_generator%2F%22%3B%0D%0A++++var+query+%3D+url+%2B+%22%3Fjs_code%3D%22%3B%0D%0A++++var+active+%3D+document.activeElement+%3F+document.activeElement+%3A+document.body%3B%0D%0A++++var+ahref+%3D+active.href+%3F+active.href+%3A+%22%22%3B%0D%0A++++var+select+%3D+document.getSelection+%3F+document.getSelection%28%29.toString%28%29.replace%28%2F%5E%5B%5Cs%5CuFEFF%5CxA0%5D%2B%7C%5B%5Cs%5CuFEFF%5CxA0%5D%2B%24%2Fg%2C+%22%22%29+%3A+%22%22%3B%0D%0A++++var+pattern+%3D+%2F%5Ejavascript%3A%28%5Cw%7C%5B%5C-.%7E%21%24%26%27%28%29*%2B%2C%3B%3D%3A%40%5D%7C%25%5B0-9A-F%5D%7B2%7D%29%2B%24%2Fi%3B%0D%0A%0D%0A++++if%28active.tagName.toLowerCase%28%29+%3D%3D%3D+%22a%22+%26%26+pattern.test%28ahref%29%29+%7B%0D%0A++++++++location.href+%3D+query+%2B+ahref.substring%2811%29+%2B+%28active.title+%3F+%22%26name%3D%22+%2B+formUrlEncode%28active.title%29+%3A+%22%22%29%3B%0D%0A++++%7D+else+if%28pattern.test%28select%29%29+%7B%0D%0A++++++++location.href+%3D+query+%2B+select.substring%2811%29%3B%0D%0A++++%7D+else+if%28select%29+%7B%0D%0A++++++++location.href+%3D+query+%2B+formUrlEncode%28select%29%3B%0D%0A++++%7D+else+%7B%0D%0A++++++++location.href+%3D+url%3B%0D%0A++++%7D%0D%0A%7D%29%28document%2C+location%29%3B&amp;name=Bookmarklet+Generator&amp;optimize=cc_SIMPLE_OPTIMIZATIONS">Bookmarklet this tool</a></li>
					<li id="download"><a href="https://purl.org/meta/utility/bookmarklet_generator/download">Download</a></li>
					<li id="updateCheck"><a type="text/javascript" href="https://purl.org/meta/utility/bookmarklet_generator/scripts/version.js">Update check</a></li>
				</ul>
			</nav>

			<p id="copyright"><small>Copyright © 2019 風は風に. Some rights reserved.</small></p>
		</footer>
	</body>
</html>